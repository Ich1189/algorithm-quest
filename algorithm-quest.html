<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Quest - Game Berpikir Komputasional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .step-card {
            transition: all 0.3s ease;
        }
        
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">🧠</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Algorithm Quest</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-purple-100 px-4 py-2 rounded-full">
                        <span class="text-purple-800 font-semibold">👤 <span id="playerName">Siswa</span></span>
                    </div>
                    <div class="bg-yellow-100 px-4 py-2 rounded-full">
                        <span class="text-yellow-800 font-semibold">Skor: <span id="score">0</span></span>
                    </div>
                    <div class="bg-green-100 px-4 py-2 rounded-full">
                        <span class="text-green-800 font-semibold">Level: <span id="level">1</span></span>
                    </div>
                    <div class="bg-blue-100 px-4 py-2 rounded-full">
                        <span class="text-blue-800 font-semibold">⏱️ <span id="timer">00:00</span></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Game Container -->
    <div class="container mx-auto px-6 py-8">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="text-center">
            <div class="bg-white rounded-2xl shadow-xl p-8 max-w-2xl mx-auto bounce-in">
                <div class="text-6xl mb-4">🎮</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Selamat Datang di Algorithm Quest!</h2>
                <p class="text-gray-600 mb-6 text-lg">
                    Game interaktif untuk belajar berpikir komputasional dan menyusun algoritma. 
                    Selesaikan tantangan dengan mengurutkan langkah-langkah yang benar!
                </p>
                
                <!-- Student Name Input -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl mb-6">
                    <h3 class="font-semibold text-gray-800 mb-4">Masukkan Nama Anda</h3>
                    <input type="text" id="studentName" placeholder="Contoh: Ahmad Rizki" 
                           class="w-full px-4 py-3 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:outline-none text-center text-lg font-medium"
                           maxlength="30">
                    <p class="text-sm text-gray-600 mt-2">Nama akan ditampilkan di papan peringkat</p>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h3 class="font-semibold text-blue-800 mb-2">Konsep yang Akan Dipelajari:</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm text-blue-700">
                        <div>✓ Dekomposisi Masalah</div>
                        <div>✓ Pengenalan Pola</div>
                        <div>✓ Abstraksi</div>
                        <div>✓ Algoritma</div>
                    </div>
                </div>
                <button onclick="startGame()" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-full font-semibold text-lg hover:from-blue-600 hover:to-purple-700 transition-all pulse-animation">
                    Mulai Bermain 🚀
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <!-- Challenge Info -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Tantangan <span id="challengeNumber">1</span></h3>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-600">Konsep:</span>
                        <span id="conceptBadge" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Dekomposisi</span>
                    </div>
                </div>
                <div id="challengeDescription" class="text-gray-700 text-lg mb-4">
                    Susun langkah-langkah untuk membuat secangkir teh dengan urutan yang benar!
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <p class="text-yellow-800 text-sm">
                        💡 <strong>Tips:</strong> <span id="challengeTip">Pikirkan urutan logis dari awal hingga akhir. Apa yang harus dilakukan pertama kali?</span>
                    </p>
                </div>
            </div>

            <!-- Drag and Drop Area -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Steps Pool -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">📝</span> Langkah-langkah Tersedia
                    </h4>
                    <div id="stepsPool" class="space-y-3 min-h-[300px]">
                        <!-- Steps will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Solution Area -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">🎯</span> Urutan Algoritma Anda
                    </h4>
                    <div id="solutionArea" class="space-y-3 min-h-[300px] border-2 border-dashed border-gray-300 rounded-lg p-4">
                        <p class="text-gray-500 text-center">Seret langkah-langkah ke sini untuk menyusun algoritma</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mt-6">
                <button onclick="checkSolution()" id="checkBtn" class="bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Periksa Jawaban ✓
                </button>
                <button onclick="resetChallenge()" class="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                    Reset 🔄
                </button>
                <button onclick="showHint()" class="bg-yellow-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-yellow-600 transition-colors">
                    Petunjuk 💡
                </button>
                <button onclick="showLeaderboard()" class="bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-600 transition-colors">
                    Peringkat 🏆
                </button>
            </div>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboardSection" class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">🏆</span> Papan Peringkat Kelas
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Peringkat</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Nama Siswa</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Skor</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Level</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Waktu Total</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr>
                            <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                                Belum ada data siswa. Mulai bermain untuk muncul di peringkat!
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="resultModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 bounce-in">
                <div class="text-center">
                    <div id="resultIcon" class="text-6xl mb-4">🎉</div>
                    <h3 id="resultTitle" class="text-2xl font-bold mb-4">Selamat!</h3>
                    <p id="resultMessage" class="text-gray-600 mb-6">Anda berhasil menyelesaikan tantangan ini!</p>
                    <div id="resultScore" class="bg-green-100 p-4 rounded-lg mb-6">
                        <p class="text-green-800 font-semibold">Skor yang Diperoleh: +100</p>
                    </div>
                    <button onclick="nextChallenge()" id="nextBtn" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors w-full">
                        Tantangan Berikutnya →
                    </button>
                </div>
            </div>
        </div>

        <!-- Hint Modal -->
        <div id="hintModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4">
                <div class="text-center">
                    <div class="text-4xl mb-4">💡</div>
                    <h3 class="text-xl font-bold mb-4">Petunjuk</h3>
                    <p id="hintText" class="text-gray-600 mb-6">Mulai dengan langkah persiapan terlebih dahulu!</p>
                    <button onclick="closeHint()" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        Mengerti!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let currentChallenge = 0;
        let score = 0;
        let level = 1;
        let draggedElement = null;
        let playerName = '';
        let startTime = null;
        let challengeStartTime = null;
        let timerInterval = null;
        let leaderboard = JSON.parse(localStorage.getItem('algorithmQuestLeaderboard')) || [];

        // Challenge Data
        const challenges = [
            {
                title: "Membuat Secangkir Teh",
                concept: "Dekomposisi",
                description: "Susun langkah-langkah untuk membuat secangkir teh dengan urutan yang benar!",
                tip: "Pikirkan urutan logis dari awal hingga akhir. Apa yang harus dilakukan pertama kali?",
                steps: [
                    "Siapkan cangkir dan sendok",
                    "Didihkan air",
                    "Masukkan teh celup ke dalam cangkir",
                    "Tuang air panas ke dalam cangkir",
                    "Aduk teh selama 2-3 menit",
                    "Angkat teh celup",
                    "Tambahkan gula sesuai selera",
                    "Teh siap disajikan"
                ],
                correctOrder: [0, 1, 2, 3, 4, 5, 6, 7],
                hint: "Mulai dengan persiapan alat, lalu siapkan air panas, baru masukkan teh!"
            },
            {
                title: "Algoritma Pencarian Buku di Perpustakaan",
                concept: "Pengenalan Pola",
                description: "Susun langkah-langkah untuk mencari buku di perpustakaan dengan efisien!",
                tip: "Pikirkan pola pencarian yang sistematis dan efisien.",
                steps: [
                    "Catat judul dan pengarang buku yang dicari",
                    "Cek katalog perpustakaan (online/offline)",
                    "Catat nomor klasifikasi buku",
                    "Pergi ke rak sesuai nomor klasifikasi",
                    "Cari buku berdasarkan urutan nomor",
                    "Ambil buku yang ditemukan",
                    "Periksa apakah buku sesuai",
                    "Pinjam buku di meja sirkulasi"
                ],
                correctOrder: [0, 1, 2, 3, 4, 5, 6, 7],
                hint: "Gunakan sistem katalog untuk menemukan lokasi buku dengan cepat!"
            },
            {
                title: "Menyelesaikan Masalah Komputer Hang",
                concept: "Abstraksi",
                description: "Susun langkah-langkah troubleshooting ketika komputer mengalami hang!",
                tip: "Fokus pada langkah-langkah penting, abaikan detail yang tidak perlu.",
                steps: [
                    "Identifikasi gejala masalah",
                    "Coba tekan Ctrl+Alt+Del",
                    "Tunggu beberapa saat",
                    "Jika tidak responsif, restart paksa",
                    "Periksa hardware (RAM, hard disk)",
                    "Scan virus dan malware",
                    "Update driver dan sistem operasi",
                    "Test stabilitas sistem"
                ],
                correctOrder: [0, 1, 2, 3, 4, 5, 6, 7],
                hint: "Mulai dengan solusi sederhana sebelum ke langkah yang kompleks!"
            },
            {
                title: "Algoritma Bubble Sort",
                concept: "Algoritma",
                description: "Susun langkah-langkah algoritma bubble sort untuk mengurutkan data!",
                tip: "Bubble sort membandingkan elemen bersebelahan dan menukarnya jika perlu.",
                steps: [
                    "Mulai dari elemen pertama array",
                    "Bandingkan dengan elemen sebelahnya",
                    "Jika lebih besar, tukar posisinya",
                    "Lanjut ke pasangan elemen berikutnya",
                    "Ulangi hingga akhir array",
                    "Kembali ke awal array",
                    "Ulangi proses untuk n-1 kali",
                    "Array sudah terurut"
                ],
                correctOrder: [0, 1, 2, 3, 4, 5, 6, 7],
                hint: "Elemen terbesar akan 'menggelembung' ke akhir di setiap iterasi!"
            }
        ];

        function startGame() {
            const nameInput = document.getElementById('studentName');
            playerName = nameInput.value.trim();
            
            if (!playerName) {
                alert('Silakan masukkan nama Anda terlebih dahulu!');
                nameInput.focus();
                return;
            }
            
            // Update player name in header
            document.getElementById('playerName').textContent = playerName;
            
            // Initialize timer
            startTime = new Date();
            challengeStartTime = new Date();
            startTimer();
            
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            loadChallenge();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const now = new Date();
                const elapsed = Math.floor((now - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function loadChallenge() {
            const challenge = challenges[currentChallenge];
            
            // Reset challenge start time
            challengeStartTime = new Date();
            
            document.getElementById('challengeNumber').textContent = currentChallenge + 1;
            document.getElementById('conceptBadge').textContent = challenge.concept;
            document.getElementById('challengeDescription').textContent = challenge.description;
            document.getElementById('challengeTip').textContent = challenge.tip;
            
            // Load steps
            const stepsPool = document.getElementById('stepsPool');
            stepsPool.innerHTML = '';
            
            // Shuffle steps for challenge
            const shuffledSteps = [...challenge.steps].sort(() => Math.random() - 0.5);
            
            shuffledSteps.forEach((step, index) => {
                const stepElement = createStepElement(step, index);
                stepsPool.appendChild(stepElement);
            });
            
            // Clear solution area
            const solutionArea = document.getElementById('solutionArea');
            solutionArea.innerHTML = '<p class="text-gray-500 text-center">Seret langkah-langkah ke sini untuk menyusun algoritma</p>';
            
            // Update leaderboard display
            updateLeaderboardDisplay();
        }

        function createStepElement(text, index) {
            const div = document.createElement('div');
            div.className = 'step-card bg-blue-50 border border-blue-200 p-4 rounded-lg cursor-move hover:bg-blue-100 transition-colors';
            div.draggable = true;
            div.dataset.stepText = text;
            div.dataset.originalIndex = challenges[currentChallenge].steps.indexOf(text);
            
            div.innerHTML = `
                <div class="flex items-center">
                    <span class="text-blue-600 mr-3">⋮⋮</span>
                    <span class="text-gray-800">${text}</span>
                </div>
            `;
            
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragend', handleDragEnd);
            
            return div;
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.style.opacity = '0.5';
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            draggedElement = null;
        }

        // Setup drop zones
        document.addEventListener('DOMContentLoaded', function() {
            const solutionArea = document.getElementById('solutionArea');
            const stepsPool = document.getElementById('stepsPool');
            
            [solutionArea, stepsPool].forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
            });
        });

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('bg-blue-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('bg-blue-50');
            
            if (draggedElement) {
                const targetZone = e.currentTarget;
                
                if (targetZone.id === 'solutionArea') {
                    // Remove placeholder text if exists
                    const placeholder = targetZone.querySelector('p');
                    if (placeholder) placeholder.remove();
                    
                    // Add step to solution
                    const stepClone = draggedElement.cloneNode(true);
                    stepClone.className = 'step-card bg-green-50 border border-green-200 p-4 rounded-lg cursor-move hover:bg-green-100 transition-colors slide-in';
                    stepClone.addEventListener('dragstart', handleDragStart);
                    stepClone.addEventListener('dragend', handleDragEnd);
                    
                    targetZone.appendChild(stepClone);
                    draggedElement.remove();
                } else if (targetZone.id === 'stepsPool') {
                    // Return step to pool
                    const stepClone = draggedElement.cloneNode(true);
                    stepClone.className = 'step-card bg-blue-50 border border-blue-200 p-4 rounded-lg cursor-move hover:bg-blue-100 transition-colors slide-in';
                    stepClone.addEventListener('dragstart', handleDragStart);
                    stepClone.addEventListener('dragend', handleDragEnd);
                    
                    targetZone.appendChild(stepClone);
                    draggedElement.remove();
                    
                    // Add placeholder if solution area is empty
                    const solutionArea = document.getElementById('solutionArea');
                    if (solutionArea.children.length === 0) {
                        solutionArea.innerHTML = '<p class="text-gray-500 text-center">Seret langkah-langkah ke sini untuk menyusun algoritma</p>';
                    }
                }
            }
        }

        function checkSolution() {
            const solutionArea = document.getElementById('solutionArea');
            const steps = Array.from(solutionArea.querySelectorAll('.step-card'));
            
            if (steps.length === 0) {
                alert('Silakan susun langkah-langkah terlebih dahulu!');
                return;
            }
            
            const userOrder = steps.map(step => parseInt(step.dataset.originalIndex));
            const correctOrder = challenges[currentChallenge].correctOrder;
            
            const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrder);
            
            showResult(isCorrect);
        }

        function showResult(isCorrect) {
            const modal = document.getElementById('resultModal');
            const icon = document.getElementById('resultIcon');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            const scoreDiv = document.getElementById('resultScore');
            
            if (isCorrect) {
                // Calculate challenge completion time
                const challengeTime = Math.floor((new Date() - challengeStartTime) / 1000);
                const timeBonus = Math.max(50 - challengeTime, 10); // Bonus for speed
                const totalPoints = 100 + timeBonus;
                
                icon.textContent = '🎉';
                title.textContent = 'Selamat!';
                message.textContent = `Anda berhasil menyelesaikan tantangan ini dalam ${formatTime(challengeTime)}!`;
                scoreDiv.innerHTML = `
                    <p class="text-green-800 font-semibold">Skor Dasar: +100</p>
                    <p class="text-green-800 font-semibold">Bonus Kecepatan: +${timeBonus}</p>
                    <p class="text-green-800 font-bold text-lg">Total: +${totalPoints}</p>
                `;
                scoreDiv.className = 'bg-green-100 p-4 rounded-lg mb-6';
                
                score += totalPoints;
                document.getElementById('score').textContent = score;
                
                if ((currentChallenge + 1) % 2 === 0) {
                    level++;
                    document.getElementById('level').textContent = level;
                }
                
                // Update leaderboard
                updateLeaderboard();
            } else {
                icon.textContent = '😅';
                title.textContent = 'Belum Tepat!';
                message.textContent = 'Urutan langkah-langkah belum benar. Coba lagi ya!';
                scoreDiv.innerHTML = '<p class="text-red-800 font-semibold">Coba periksa urutan langkah-langkahnya!</p>';
                scoreDiv.className = 'bg-red-100 p-4 rounded-lg mb-6';
                
                document.getElementById('nextBtn').textContent = 'Coba Lagi';
                document.getElementById('nextBtn').onclick = closeResult;
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function nextChallenge() {
            closeResult();
            
            if (currentChallenge < challenges.length - 1) {
                currentChallenge++;
                loadChallenge();
            } else {
                // Game completed
                stopTimer();
                const totalTime = Math.floor((new Date() - startTime) / 1000);
                
                // Final leaderboard update
                updateLeaderboard(true);
                
                alert(`🎊 Selamat! Anda telah menyelesaikan semua tantangan!\n\nSkor Akhir: ${score}\nLevel: ${level}\nWaktu Total: ${formatTime(totalTime)}\n\nAnda telah menguasai konsep berpikir komputasional!`);
                
                // Reset game
                currentChallenge = 0;
                score = 0;
                level = 1;
                document.getElementById('score').textContent = score;
                document.getElementById('level').textContent = level;
                document.getElementById('timer').textContent = '00:00';
                
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('welcomeScreen').classList.remove('hidden');
            }
        }

        function closeResult() {
            const modal = document.getElementById('resultModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // Reset next button
            document.getElementById('nextBtn').textContent = 'Tantangan Berikutnya →';
            document.getElementById('nextBtn').onclick = nextChallenge;
        }

        function resetChallenge() {
            loadChallenge();
        }

        function showHint() {
            const hintModal = document.getElementById('hintModal');
            const hintText = document.getElementById('hintText');
            
            hintText.textContent = challenges[currentChallenge].hint;
            
            hintModal.classList.remove('hidden');
            hintModal.classList.add('flex');
        }

        function closeHint() {
            const hintModal = document.getElementById('hintModal');
            hintModal.classList.add('hidden');
            hintModal.classList.remove('flex');
        }

        function updateLeaderboard(isCompleted = false) {
            const totalTime = Math.floor((new Date() - startTime) / 1000);
            const existingPlayerIndex = leaderboard.findIndex(player => player.name === playerName);
            
            const playerData = {
                name: playerName,
                score: score,
                level: level,
                totalTime: totalTime,
                completed: isCompleted,
                timestamp: new Date().toISOString()
            };
            
            if (existingPlayerIndex >= 0) {
                // Update existing player if score is better
                if (score > leaderboard[existingPlayerIndex].score || 
                    (score === leaderboard[existingPlayerIndex].score && totalTime < leaderboard[existingPlayerIndex].totalTime)) {
                    leaderboard[existingPlayerIndex] = playerData;
                }
            } else {
                leaderboard.push(playerData);
            }
            
            // Sort leaderboard by score (desc) then by time (asc)
            leaderboard.sort((a, b) => {
                if (b.score !== a.score) return b.score - a.score;
                return a.totalTime - b.totalTime;
            });
            
            // Keep only top 10
            leaderboard = leaderboard.slice(0, 10);
            
            // Save to localStorage
            localStorage.setItem('algorithmQuestLeaderboard', JSON.stringify(leaderboard));
            
            updateLeaderboardDisplay();
        }

        function updateLeaderboardDisplay() {
            const tbody = document.getElementById('leaderboardBody');
            
            if (leaderboard.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                            Belum ada data siswa. Mulai bermain untuk muncul di peringkat!
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = leaderboard.map((player, index) => {
                const isCurrentPlayer = player.name === playerName;
                const rowClass = isCurrentPlayer ? 'bg-blue-50 border-l-4 border-blue-500' : '';
                const rankIcon = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}`;
                const status = player.completed ? '✅ Selesai' : '🎮 Bermain';
                
                return `
                    <tr class="${rowClass}">
                        <td class="px-4 py-3 font-semibold">${rankIcon}</td>
                        <td class="px-4 py-3 font-medium ${isCurrentPlayer ? 'text-blue-700' : ''}">${player.name}</td>
                        <td class="px-4 py-3 font-semibold text-yellow-600">${player.score}</td>
                        <td class="px-4 py-3">${player.level}</td>
                        <td class="px-4 py-3">${formatTime(player.totalTime)}</td>
                        <td class="px-4 py-3">${status}</td>
                    </tr>
                `;
            }).join('');
        }

        function showLeaderboard() {
            const leaderboardSection = document.getElementById('leaderboardSection');
            leaderboardSection.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976bd4355070fd85',t:'MTc1NjQ2ODIwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
